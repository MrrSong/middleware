# protocol

## 指令代号 初始化指令

### 描述

可视化界面→模拟器

仿真场景设置及无人艇配置

### 示例

```
{
    "time_scale": 1,
    "wave_degree": 1,
    "weather":1,
    "hour":13,
    "x_leftTop_longtitude": 134,
    "y_leftTop_latitude": 11,
    "x_rightBottom_longtitude": 135,
    "y_rightBottom_latitude": 10,
    "boats": [
        {
            "id": 1,
            "type": 1,
            "team": 0,
            "x_longtitude": 134.500,
            "y_latitude": 10.5,
            "startAngle": 0,
            "health": 100,
            "gas_outputRate":100,
            "attack_radius": 100,
            "attack": 20
        }
    ],
    "obstacles": [
        {
            "id": 101,
            "type": 101,
            "x_longtitude": 134.50,
            "y_latitude": 10.505,
            "startAngle": 0
        }
    ],
    "map_max_distance": 2000,
    "task_area_center_longtitude": 134.48,
    "task_area_center_latitude": 10.48,
    "task_area_radius": 5000,
    "gas_p":0.1,
    "gas_i":0.001,
    "gas_d":0.5,
    "steering_p":0.15,
    "steering_i":0.001,
    "steering_d":0.13
}
```

|     参数名     | 类型 |                           说明                            |
| :------------: | :--: | :-------------------------------------------------------: |
| SimConfig.json | json | 与配置文件SimConfig.json中的内容相同, json 转为字符串发送 |

## 指令代号 21

### 描述

模拟器→可视化界面

无人艇集群运动状态

### 示例

```python
[21, para1, para2, …]
```

|   参数名   |          类型           |                             说明                             |
| :--------: | :---------------------: | :----------------------------------------------------------: |
| **para1**  |           int           |                         无人艇数量 n                         |
| **para2**  |          float          |                          艇全局编号                          |
| **para3**  |          float          |                经度，单位: °, 保留小数点后8位                |
| **para4**  |          float          |                纬度，单位: °, 保留小数点后8位                |
| **para5**  |          float          |              偏航角，单位: °, 范围: [-180, 180)              |
| **para6**  |          float          |                   偏航角速度，单位: rad/s                    |
| **para7**  |          float          |                 偏航角加速度，单位: rad/s^2                  |
| **para8**  |          float          |                       俯仰角，单位: °                        |
| **para9**  |          float          |                       横滚角，单位: °                        |
| **para10** |          float          |                     前向速度，单位: m/s                      |
| **para11** |          float          |                   前向加速度，单位: m/s^2                    |
| **para12** |          float          |                     横向速度，单位: m/s                      |
| **para13** |          float          |                   横向加速度，单位: m/s^2                    |
| **para14** |          float          |              航向角，单位: °, 范围: [-180, 180)              |
| **para15** |           int           |                  当前状态，1: 正常, 0: 故障                  |
| **para16** |           int           |                       当前执行任务类型                       |
| **para17** |           int           |                           目标编号                           |
| **para18** |           int           | 当前执行的运动控制模式 0: 无; 2: 舵角/油门控制; 3: 航向/速度控制; |
| **para19** |          float          | control_mode = 2 时为当前舵角值; control_mode = 3 时为3时为当前期望航向值; |
| **para20** |          float          | control_mode = 2 时为当前油门值; control_mode = 3 时为3时为当前期望速度值; |
| **para21** |          float          |                            生命值                            |
| **para22** |            /            |                       其他艇同para2~21                       |
| **para23** | yyyy-MM-dd-HH-mm-ss-fff |                            时间戳                            |

## 指令代号 22

### 描述

可视化界面→模拟器

无人艇运动控制

### 示例

```python
[22, para1, para2, …]
```

|   参数名   | 类型 |                             说明                             |
| :--------: | :--: | :----------------------------------------------------------: |
| **para1**  | int  |                          艇全局编号                          |
| **para2**  | int  | 艇执行任务类型: 0:无任务或未知任务; 1:护 航;2:对抗(守方);3:对抗(攻方);4:单艇控制任务 (2D 显控控制;优先级高于决策); 5:环形护卫; 6:3V3 科目一场景编队任务等; |
| **para3**  | int  | 执行任务类型为 1 时,为护航目标全局编号; 执行任务类型为 2 时,为守卫目标全局编号; 执行任务类型为 3 时,为攻击目标全局编号; 执行任务类型为 4 时,此位预留, 填 0; 执行任务类型为 5 时,为侦察目标全局编号; |
| **para4**  | int  |      运动控制模式为 1,4 或 5 时，为收到的航路 任务编号;      |
| **para5**  | int  |                         预留, 置 0;                          |
| **para6**  | int  | 运动控制模式;0:无;1:航点/速度控制;2:舵角/ 油门控制;3:航向/速度控制;4:航点/时间控 制;5:航点/变速度; |
| **para7**  | int  | 油门或速度值;控制模式为 2 时为油门值,范围 为[0,100];控制模式为 3 或 5 时为速度值,单 位: m/s; |
| **para8**  | int  | 舵角值或航向值; 单位: °; 控制模式为 2 时 为舵角值, 范围为[-30, 30]; 控制模式为 3 时 为航向值; 范围为[0, 360 ); |
| **para9**  | int  | 与上一帧下发航点/速度是否有改变; 1: 有; 0: 无; 控制模式为 1、4 和 5 时响应; 当运动控 制模式为 5 时且该位为 0 时，要判断速度是 否有改变,实时切换速度； |
| **para10** | int  |         航点个数 n;无航点置 0;控制模式为 1、4 响 应;         |
| **para11** | int  | 航点 1 经度; 单位: °; 保留小数点后 8 位; 控制模式为 1、4 时响应; |
| **para12** | int  | 航点 1 纬度; 单位: °; 保留小数点后 8 位; 控制模式为 1、4 时响应; |
| **para13** | int  | 控制模式为 1、4 时响应, 运动控制模式为 1 时,为到航点 1 的速度;单位:m/s;运动控制模式 为 4 时,到航点 1 的时间; |
| **para14** | int  |                    航点 2 信息; 同航点 1;                    |
| **para15** | int  |                      航点 n; 同航点 1;                       |

## 指令代号 26

### 描述

可视化界面→模拟器

模拟器开始、结束控制

### 示例

```python
[26, para1]
```

| 参数名 | 类型 |                             说明                             |
| :----: | :--: | :----------------------------------------------------------: |
| para1  | int  | 控制信息; 0：强制结束仿真并回到主菜单；1: 实操模式开始；2: 仿真模式开始；3：实艇模式开始 |

